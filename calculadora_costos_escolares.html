<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Costos Escolares 2025-2026</title>

    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="Calculadora de Costos Escolares">
    <meta property="og:description" content="Herramienta interactiva para estimar y visualizar los costos de maestros y gastos fijos durante el ciclo escolar.">
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/179/179373.png">
    <meta property="og:url" content="https://Marcorepositorioprueba.github.io/calculadora-escolar/calculadora_costos_escolares.html">
    <meta property="og:type" content="website">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #005a9c;
            color: #ffffff;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .logo {
            height: 110px;
            margin-right: 20px;
        }
        .header-text {
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 600;
            color: #ffffff;
        }
        header h2 {
            margin: 0.25rem 0 0;
            font-size: 1.3rem;
            font-weight: 300;
            color: #ffffff;
        }
        .main-container {
            display: flex;
            flex-direction: column; /* Para apilar la calculadora y el calendario */
            align-items: center; /* Centrar los elementos */
            min-height: calc(100vh - 150px);
            padding: 20px;
            box-sizing: border-box;
            gap: 20px; /* Espacio entre calculadora y calendario */
        }
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
            text-align: center;
        }
        .container h1 {
            color: #0056b3;
            margin-bottom: 25px;
            font-weight: 700;
            font-size: 1.8rem;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .control-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            min-width: 220px;
        }
        .control-group label {
            font-weight: 500;
            margin-bottom: 10px;
            display: block;
            color: #495057;
        }
        select, input[type="number"], .options-list div {
            margin-top: 5px;
        }
        select, input[type="number"] {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ced4da;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        .options-list input[type="checkbox"] {
            margin-right: 8px;
        }
        .results {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid #d6d8db;
        }
        .results h2 {
            margin-top: 0;
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }
        .result-item {
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        .result-item strong {
            color: #0056b3;
            font-weight: 500;
        }
        .total-cost {
            font-size: 1.5em;
            font-weight: 700;
            color: #dc3545;
            text-align: center;
            margin-top: 20px;
        }
        .operating-balance {
            font-size: 1.6em;
            font-weight: 700;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        .positive-balance { background-color: #e8f5e9; color: #2e7d32; }
        .negative-balance { background-color: #ffebee; color: #c62828; }
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        /* Estilos del Calendario */
        #calendar-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            max-width: 1200px; /* Más ancho para el calendario */
        }
        .month-table {
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .month-table th, .month-table td {
            text-align: center;
            padding: 0.75rem;
            font-size: 0.9rem;
        }
        .month-table thead th {
            background-color: #007bff;
            color: white;
            font-size: 1.1rem;
        }
        .month-table .day-header td {
            font-weight: bold;
            color: #6c757d;
            font-size: 0.8rem;
        }
        .month-table tbody td {
            border: 1px solid #f1f1f1;
            color: #495057;
        }
        .month-table .weekend {
            background-color: #f8f9fa;
            color: #adb5bd;
        }
        .month-table .not-in-month {
            color: #e9ecef;
        }
        .highlight-week {
            background-color: rgba(54, 162, 235, 0.2);
        }
        .highlight-effective-day {
            background-color: rgba(40, 167, 69, 0.4);
            font-weight: bold;
        }
    </style>
</head>
<body>

<header>
    <img src="images/escudo1.png" alt="Logo Escuela" class="logo">
    <div class="header-text">
        <h1>APF Escuela Primaria Ignacio Zaragoza</h1>
        <h2>Control de Maestros</h2>
    </div>
</header>

<div class="main-container">
    <div class="container">
        <h1>Calculadora de Costos Escolares 2025-2026</h1>
        <p>Periodo a calcular: del <strong>21 de octubre de 2025</strong> al <strong>15 de julio de 2026</strong>.</p>

        <div class="controls">
            <div class="control-group">
                <label for="initial_balance">Saldo Inicial (TEse):</label>
                <input type="number" id="initial_balance" placeholder="$ 0.00">
            </div>
            <div class="control-group">
                <label for="scenario">Escenario de Cálculo:</label>
                <select id="scenario">
                    <option value="weeks">1. Por Semanas Totales</option>
                    <option value="days">2. Por Días Efectivos</option>
                </select>
            </div>
            <div class="control-group">
                <label>Costos Variables (Maestros):</label>
                <div class="options-list">
                    <div>
                        <input type="checkbox" id="teacher_ingles" name="teacher" value="ingles" checked>
                        <label for="teacher_ingles">Inglés ($1000/sem | $100/clase)</label>
                    </div>
                    <div>
                        <input type="checkbox" id="teacher_compu" name="teacher" value="compu" checked>
                        <label for="teacher_compu">Computación ($1000/sem | $100/clase)</label>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <label>Costo Fijo Mensual:</label>
                <div class="options-list">
                    <div>
                        <input type="checkbox" id="fixed_agua" name="fixed_cost" value="agua" checked>
                        <label for="fixed_agua">Consumo de Agua ($4,093/mes)</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="results">
            <h2>Resultados del Cálculo</h2>
            <div class="result-item">
                <span id="calculation_unit">Semanas efectivas:</span>
                <strong id="unit_count">0</strong>
            </div>
            <div class="total-cost">
                Costo Total Estimado: <strong id="total_cost">$0.00</strong>
            </div>
            <div id="operating_balance_container" style="display: none;">
                <div class="operating-balance">
                    Saldo Operativo Restante: <strong id="operating_balance">$0.00</strong>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="costChart"></canvas>
        </div>
    </div>

    <div id="calendar-container"></div>
</div>

<script>
    // --- CONFIGURACIÓN ---
    const startDate = new Date('2025-10-21T00:00:00-06:00');
    const endDate = new Date('2026-07-15T23:59:59-06:00');

    const costs = {
        perWeekPerTeacher: 1000,
        perClassPerTeacher: 100,
        fixedWater: 4093
    };

    const holidays = [
        '2025-09-16', '2025-11-17', '2025-12-25', '2026-01-01', 
        '2026-02-02', '2026-03-16', '2026-05-01', '2026-05-05', '2026-05-15'
    ].map(d => new Date(d + 'T12:00:00Z').toDateString());

    const vacationPeriods = [
        { start: new Date('2025-12-19T00:00:00-06:00'), end: new Date('2026-01-07T23:59:59-06:00') },
        { start: new Date('2026-04-06T00:00:00-06:00'), end: new Date('2026-04-17T23:59:59-06:00') }
    ];

    // --- ELEMENTOS DEL DOM ---
    const initialBalanceInput = document.getElementById('initial_balance');
    const scenarioSelect = document.getElementById('scenario');
    const teacherCheckboxes = document.querySelectorAll('input[name="teacher"]');
    const fixedCostCheckboxes = document.querySelectorAll('input[name="fixed_cost"]');
    const unitLabel = document.getElementById('calculation_unit');
    const unitCount = document.getElementById('unit_count');
    const totalCostElem = document.getElementById('total_cost');
    const opBalanceContainer = document.getElementById('operating_balance_container');
    const opBalanceElem = document.getElementById('operating_balance');
    const opBalanceDiv = opBalanceContainer.querySelector('.operating-balance');
    const chartCanvas = document.getElementById('costChart');
    const calendarContainer = document.getElementById('calendar-container');

    let costChart;

    // --- LÓGICA DE CÁLCULO ---
    function isHoliday(date) {
        if (holidays.includes(date.toDateString())) return true;
        for (const period of vacationPeriods) {
            if (date >= period.start && date <= period.end) return true;
        }
        return false;
    }

    function calculateEffectiveDays() {
        let count = 0;
        let currentDate = new Date(startDate);
        while (currentDate <= endDate) {
            const dayOfWeek = currentDate.getDay();
            if (dayOfWeek !== 0 && dayOfWeek !== 6 && !isHoliday(new Date(currentDate))) {
                count++;
            }
            currentDate.setDate(currentDate.getDate() + 1);
        }
        return count;
    }

    function calculateTotalWeeks() {
        const diffTime = Math.abs(endDate - startDate);
        return (diffTime / (1000 * 60 * 60 * 24 * 7));
    }
    
    function calculateNumberOfMonths() {
        return (endDate.getFullYear() - startDate.getFullYear()) * 12 + (endDate.getMonth() - startDate.getMonth()) + 1;
    }

    function updateUI() {
        const initialBalance = parseFloat(initialBalanceInput.value) || 0;
        const scenario = scenarioSelect.value;
        const teacherCount = Array.from(teacherCheckboxes).filter(cb => cb.checked).length;
        
        let calculatedUnits = 0;
        let variableCost = 0;

        if (scenario === 'weeks') {
            calculatedUnits = calculateTotalWeeks();
            variableCost = calculatedUnits * costs.perWeekPerTeacher * teacherCount;
            unitLabel.textContent = 'Semanas totales (aprox.):';
            unitCount.textContent = calculatedUnits.toFixed(2);
        } else { // days
            calculatedUnits = calculateEffectiveDays();
            variableCost = calculatedUnits * costs.perClassPerTeacher * teacherCount;
            unitLabel.textContent = 'Días efectivos de clase:';
            unitCount.textContent = calculatedUnits;
        }

        let fixedCost = 0;
        const months = calculateNumberOfMonths();
        if (document.getElementById('fixed_agua').checked) {
            fixedCost += months * costs.fixedWater;
        }

        const totalCost = variableCost + fixedCost;
        totalCostElem.textContent = `$${totalCost.toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        
        if (initialBalance > 0) {
            const operatingBalance = initialBalance - totalCost;
            opBalanceElem.textContent = `$${operatingBalance.toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            opBalanceContainer.style.display = 'block';

            opBalanceDiv.classList.remove('positive-balance', 'negative-balance');
            if (operatingBalance >= 0) {
                opBalanceDiv.classList.add('positive-balance');
            } else {
                opBalanceDiv.classList.add('negative-balance');
            }
        } else {
            opBalanceContainer.style.display = 'none';
        }

        updateChart();
        updateCalendarHighlighting();
    }
    
    function calculateCostsForChart() {
        const teacherCount = Array.from(teacherCheckboxes).filter(cb => cb.checked).length;
        
        let fixedCost = 0;
        const months = calculateNumberOfMonths();
        if (document.getElementById('fixed_agua').checked) {
            fixedCost += months * costs.fixedWater;
        }

        const weeks = calculateTotalWeeks();
        const costByWeeks = (weeks * costs.perWeekPerTeacher * teacherCount) + fixedCost;
        
        const days = calculateEffectiveDays();
        const costByDays = (days * costs.perClassPerTeacher * teacherCount) + fixedCost;
        
        return { costByWeeks, costByDays };
    }

    function updateChart() {
        const { costByWeeks, costByDays } = calculateCostsForChart();
        costChart.data.datasets[0].data[0] = costByWeeks;
        costChart.data.datasets[0].data[1] = costByDays;
        costChart.update();
    }

    // --- LÓGICA DEL CALENDARIO ---
    function generateCalendar() {
        const calStartDate = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
        const calEndDate = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const dayNames = ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sá"];

        let currentDate = new Date(calStartDate);
        while(currentDate <= calEndDate) {
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();

            const table = document.createElement('table');
            table.className = 'month-table';
            
            const thead = table.createTHead();
            let row = thead.insertRow();
            let th = document.createElement('th');
            th.colSpan = 7;
            th.textContent = `${monthNames[month]} ${year}`;
            row.appendChild(th);

            row = thead.insertRow();
            row.className = 'day-header';
            dayNames.forEach(name => {
                let cell = row.insertCell();
                cell.textContent = name;
            });

            const tbody = table.createTBody();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let date = 1;
            for (let i = 0; i < 6; i++) {
                row = tbody.insertRow();
                for (let j = 0; j < 7; j++) {
                    let cell = row.insertCell();
                    if (i === 0 && j < firstDay) {
                        cell.classList.add('not-in-month');
                    } else if (date > daysInMonth) {
                        break;
                    } else {
                        cell.textContent = date;
                        cell.id = `date-${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        if (j === 0 || j === 6) {
                            cell.classList.add('weekend');
                        }
                        date++;
                    }
                }
            }
            calendarContainer.appendChild(table);
            currentDate.setMonth(currentDate.getMonth() + 1);
        }
    }

    function updateCalendarHighlighting() {
        // Limpiar resaltados previos
        document.querySelectorAll('.highlight-week, .highlight-effective-day').forEach(cell => {
            cell.classList.remove('highlight-week', 'highlight-effective-day');
        });

        const scenario = scenarioSelect.value;
        let currentDate = new Date(startDate);

        if (scenario === 'weeks') {
            while (currentDate <= endDate) {
                const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                const cell = document.getElementById(`date-${dateStr}`);
                if (cell) {
                    cell.classList.add('highlight-week');
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
        } else { // days
            while (currentDate <= endDate) {
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6 && !isHoliday(new Date(currentDate))) {
                    const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                    const cell = document.getElementById(`date-${dateStr}`);
                    if (cell) {
                        cell.classList.add('highlight-effective-day');
                    }
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }
    }

    // --- INICIALIZACIÓN ---
    function initialize() {
        generateCalendar();
        const ctx = chartCanvas.getContext('2d');
        const { costByWeeks, costByDays } = calculateCostsForChart();

        costChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Escenario 1: Costo Total (Semanas)', 'Escenario 2: Costo Total (Días Efect.)'],
                datasets: [{
                    label: 'Costo Total Estimado',
                    data: [costByWeeks, costByDays],
                    backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)'],
                    borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, ticks: { callback: value => '$' + value.toLocaleString('es-MX') } } },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: context => {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // Event Listeners
        initialBalanceInput.addEventListener('input', updateUI);
        scenarioSelect.addEventListener('change', updateUI);
        teacherCheckboxes.forEach(cb => cb.addEventListener('change', updateUI));
        fixedCostCheckboxes.forEach(cb => cb.addEventListener('change', updateUI));

        updateUI();
    }

    document.addEventListener('DOMContentLoaded', initialize);
</script>

</body>
</html>