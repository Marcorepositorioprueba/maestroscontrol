function doPost(e) {
  try {
    // IMPORTANTE: Asume que la hoja donde se guardan los datos se llama "Respuestas de formulario 1".
    // Si tu hoja tiene otro nombre, cámbialo en la siguiente línea.
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Respuestas de formulario 1");

    // Recoge los datos que enviará el formulario HTML
    const nombreMaestro = e.parameter.nombreMaestro;
    const horaEntrada = e.parameter.horaEntrada;
    const horaSalida = e.parameter.horaSalida;
    const fecha = e.parameter.fecha;
    const gruposAtendidos = e.parameter.gruposAtendidos;

    // Añade una nueva fila a la hoja de cálculo con los datos en el orden correcto.
    // La primera columna (Marca de tiempo) la generamos aquí mismo.
    sheet.appendRow([
      new Date(),         // Columna A: Marca de tiempo
      nombreMaestro,      // Columna B: Nombre del Maestro
      horaEntrada,        // Columna C: Hora de Entrada
      horaSalida,         // Columna D: Hora de Salida
      fecha,              // Columna E: Fecha
      gruposAtendidos     // Columna F: Grupos Atendidos
    ]);

    // Devuelve una respuesta de éxito al formulario con cabecera CORS
    return ContentService
      .createTextOutput(JSON.stringify({ "status": "success" }))
      .setMimeType(ContentService.MimeType.JSON)
      .withHeaders({'Access-Control-Allow-Origin': '*'});

  } catch (error) {
    // En caso de un error, lo registra y devuelve un mensaje de error con cabecera CORS
    return ContentService
      .createTextOutput(JSON.stringify({ "status": "error", "message": error.message }))
      .setMimeType(ContentService.MimeType.JSON)
      .withHeaders({'Access-Control-Allow-Origin': '*'});
  }
}

// Google Apps Script necesita una función doOptions para manejar las solicitudes de "pre-vuelo" (preflight) de CORS.
// Esto es necesario para las solicitudes POST complejas que envían los navegadores modernos.
function doOptions(e) {
  return ContentService
    .createTextOutput()
    .setMimeType(ContentService.MimeType.JSON)
    .withHeaders({
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type'
    });
}
